<!DOCTYPE html>
<html>
<head>
    <title>{{ flow_name }} - æµç¨‹æ§åˆ¶å°</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; background: #f5f5f5; }
        .header { background: #007bff; color: white; padding: 15px 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header h1 { margin: 0; font-size: 24px; }
        .header .breadcrumb { margin-top: 5px; opacity: 0.9; font-size: 14px; }
        .header .breadcrumb a { color: #cce5ff; text-decoration: none; }
        .header .breadcrumb a:hover { text-decoration: underline; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .flow-info { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .flow-info h2 { margin-top: 0; color: #333; }
        .flow-meta { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .meta-item { background: #f8f9fa; padding: 10px; border-radius: 4px; }
        .meta-item .label { font-weight: bold; color: #666; font-size: 12px; text-transform: uppercase; }
        .meta-item .value { font-size: 16px; color: #333; margin-top: 2px; }
        .section { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .section h3 { margin-top: 0; color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        .btn { background: #007bff; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block; margin-right: 10px; margin-bottom: 10px; }
        .btn:hover { background: #0056b3; }
        .btn-secondary { background: #6c757d; }
        .btn-success { background: #28a745; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-danger { background: #dc3545; }
        .status { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .status-running { background: #d4edda; color: #155724; }
        .status-idle { background: #cce5ff; color: #004085; }
        .status-error { background: #f8d7da; color: #721c24; }
        .logs {
            background: #1a1a1a;
            color: #e0e0e0;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #333;
            line-height: 1.4;
        }
        .log-entry { margin: 2px 0; }
        .log-info { color: #4CAF50; }
        .log-warning { color: #FF9800; }
        .log-error { color: #F44336; }
        .log-success { color: #8BC34A; }
        .log-debug { color: #9E9E9E; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        textarea { height: 100px; font-family: monospace; }
        .path-info { background: #e9ecef; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; margin-bottom: 15px; }
        .file-list { list-style: none; padding: 0; }
        .file-list li { padding: 8px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .file-list li:hover { background: #f8f9fa; }
        .file-icon { margin-right: 8px; }
        .tabs { display: flex; border-bottom: 1px solid #dee2e6; margin-bottom: 20px; }
        .tab { padding: 10px 20px; cursor: pointer; border-bottom: 2px solid transparent; }
        .tab.active { border-bottom-color: #007bff; background: #f8f9fa; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ”„ {{ flow_name }} - æµç¨‹æ§åˆ¶å°</h1>
        <div class="breadcrumb">
            <a href="/">é¦–é¡µ</a> / 
            <a href="/apps">åº”ç”¨</a> / 
            <span>{{ app_name }}</span> / 
            <span>{{ flow_name }}</span>
        </div>
    </div>

    <div class="container">
        <!-- æµç¨‹ä¿¡æ¯ -->
        <div class="flow-info">
            <h2>æµç¨‹ä¿¡æ¯</h2>
            <div class="flow-meta">
                <div class="meta-item">
                    <div class="label">åº”ç”¨åç§°</div>
                    <div class="value">{{ app_config.name }}</div>
                </div>
                <div class="meta-item">
                    <div class="label">åº”ç”¨ID</div>
                    <div class="value">{{ app_id }}</div>
                </div>
                <div class="meta-item">
                    <div class="label">æµç¨‹ID</div>
                    <div class="value">{{ flow_id }}</div>
                </div>
                <div class="meta-item">
                    <div class="label">æµç¨‹åç§°</div>
                    <div class="value">{{ flow_title }}</div>
                </div>
                <div class="meta-item">
                    <div class="label">çŠ¶æ€</div>
                    <div class="value"><span class="status status-idle">ç©ºé—²</span></div>
                </div>
            </div>
            
            <div class="path-info">
                <strong>è·¯å¾„ä¿¡æ¯:</strong><br>
                Templates: {{ flow_context.templates_path }}<br>
                Scripts: {{ flow_context.scripts_path }}
            </div>
        </div>

        <!-- æ ‡ç­¾é¡µ -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('logs')">ğŸ“‹ æ‰§è¡Œæ—¥å¿—</div>
            <div class="tab" onclick="switchTab('overview')">ğŸ“Š æ¦‚è§ˆ</div>
            <div class="tab" onclick="switchTab('templates')">ğŸ“„ æ¨¡æ¿</div>
            <div class="tab" onclick="switchTab('scripts')">ğŸ“œ è„šæœ¬</div>
        </div>

        <!-- æ—¥å¿—æ ‡ç­¾é¡µ (ç°åœ¨æ˜¯ç¬¬ä¸€ä½) -->
        <div id="logs" class="tab-content active">
            <div class="section">
                <h3>ğŸš€ å·¥ä½œæµæ§åˆ¶</h3>
                <button class="btn btn-success" onclick="startWorkflow()">å¼€å§‹ä»»åŠ¡</button>
                <button class="btn btn-warning" onclick="pauseFlow()">æš‚åœæµç¨‹</button>
                <button class="btn btn-danger" onclick="stopFlow()">åœæ­¢æµç¨‹</button>
                <button class="btn btn-secondary" onclick="refreshStatus()">åˆ·æ–°çŠ¶æ€</button>
            </div>

            <div class="section">
                <h3>ğŸ“ è¡¨å•æäº¤æ•°æ®</h3>
                <div id="form-data-container">
                    <div class="form-group">
                        <label>æäº¤çš„è¡¨å•æ•°æ®</label>
                        <div class="logs" id="form-data-display">
                            <p style="color: #9E9E9E;">æš‚æ— è¡¨å•æ•°æ®</p>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥å¹¶æ˜¾ç¤ºè¡¨å•æ•°æ®
                document.addEventListener('DOMContentLoaded', function() {
                    // ä»URLå‚æ•°ä¸­è·å–è¡¨å•æ•°æ®
                    const urlParams = new URLSearchParams(window.location.search);
                    const formData = urlParams.get('form_data');
                    const formValues = urlParams.get('form_values');

                    console.log('Form data flag:', formData);
                    console.log('Form values:', formValues);

                    if (formData === 'submitted' && formValues) {
                        try {
                            // è§£ç å¹¶æ˜¾ç¤ºè¡¨å•æ•°æ®
                            console.log('Raw encoded data:', formValues);

                            // å…ˆè¿›è¡ŒURLè§£ç 
                            const formDataJson = decodeURIComponent(formValues);
                            console.log('Decoded JSON string:', formDataJson);

                            // ç„¶åè§£æJSON
                            const parsedFormData = JSON.parse(formDataJson);
                            console.log('Parsed form data:', parsedFormData);

                            let html = '<div style="background: #2a2a2a; color: #e0e0e0; padding: 15px; border-radius: 4px; font-family: monospace;">';
                            html += '<strong style="color: #4CAF50;">ğŸ“ æäº¤çš„è¡¨å•æ•°æ®:</strong><br><br>';

                            Object.entries(parsedFormData).forEach(([key, value]) => {
                                const formattedValue = typeof value === 'object' ?
                                    JSON.stringify(value, null, 2) : String(value);
                                html += `<div style="margin: 8px 0; padding: 5px; background: #333; border-radius: 3px;">`;
                                html += `<span style="color: #FF9800; font-weight: bold;">${key}:</span> `;
                                html += `<span style="color: #e0e0e0;">${formattedValue}</span>`;
                                html += `</div>`;
                            });

                            html += '</div>';
                            document.getElementById('form-data-display').innerHTML = html;
                        } catch (e) {
                            console.error('Failed to parse form data:', e);
                            console.error('Error details:', e.message);

                            // æ˜¾ç¤ºæ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
                            let errorHtml = '<div style="background: #2a2a2a; color: #F44336; padding: 15px; border-radius: 4px; font-family: monospace;">';
                            errorHtml += '<strong>è¡¨å•æ•°æ®è§£æå¤±è´¥</strong><br><br>';
                            errorHtml += `é”™è¯¯ä¿¡æ¯: ${e.message}<br>`;
                            errorHtml += `åŸå§‹æ•°æ®: ${formValues}<br>`;
                            errorHtml += '</div>';

                            document.getElementById('form-data-display').innerHTML = errorHtml;
                        }
                    }
                });
            </script>

            <div class="section">
                <h3>æ‰§è¡Œæ—¥å¿—</h3>
                <div class="form-group">
                    <button class="btn btn-secondary" onclick="loadLogs()">åˆ·æ–°æ—¥å¿—</button>
                    <button class="btn btn-secondary" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
                </div>
                <div id="logs-container" class="logs">
                    <p>æš‚æ— æ—¥å¿—è®°å½•</p>
                </div>
            </div>
        </div>

        <!-- æ¦‚è§ˆæ ‡ç­¾é¡µ -->
        <div id="overview" class="tab-content">
            <div class="section">
                <h3>æµç¨‹æ§åˆ¶</h3>
                <button class="btn btn-success" onclick="startFlow()">å¯åŠ¨æµç¨‹</button>
                <button class="btn btn-warning" onclick="pauseFlow()">æš‚åœæµç¨‹</button>
                <button class="btn btn-danger" onclick="stopFlow()">åœæ­¢æµç¨‹</button>
                <button class="btn btn-secondary" onclick="refreshStatus()">åˆ·æ–°çŠ¶æ€</button>
            </div>

            <div class="section">
                <h3>è¾“å…¥å‚æ•°</h3>
                <div class="form-group">
                    <label>è¾“å…¥æ•°æ® (JSONæ ¼å¼):</label>
                    <textarea id="flow-input" placeholder='{"key": "value"}'></textarea>
                </div>
                <button class="btn" onclick="triggerFlow()">è§¦å‘æ‰§è¡Œ</button>
            </div>

            <div class="section">
                <h3>æ‰§è¡ŒçŠ¶æ€</h3>
                <div id="status-info">
                    <p>å½“å‰çŠ¶æ€: <span class="status status-idle">ç©ºé—²</span></p>
                    <p>æœ€åæ‰§è¡Œ: æ— </p>
                </div>
            </div>
        </div>

        <!-- æ¨¡æ¿æ ‡ç­¾é¡µ -->
        <div id="templates" class="tab-content">
            <div class="section">
                <h3>æ¨¡æ¿æ–‡ä»¶</h3>
                <div id="templates-list">
                    <p>åŠ è½½ä¸­...</p>
                </div>
            </div>
        </div>

        <!-- è„šæœ¬æ ‡ç­¾é¡µ -->
        <div id="scripts" class="tab-content">
            <div class="section">
                <h3>è„šæœ¬æ–‡ä»¶</h3>
                <div id="scripts-list">
                    <p>åŠ è½½ä¸­...</p>
                </div>
            </div>
        </div>


    </div>

    <script>
        // æµç¨‹ä¸Šä¸‹æ–‡
        const flowContext = {{ flow_context | tojson }};
        const appName = "{{ app_name }}";
        const flowName = "{{ flow_name }}";

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // åŠ è½½å¯¹åº”å†…å®¹
            if (tabName === 'templates') {
                loadTemplates();
            } else if (tabName === 'scripts') {
                loadScripts();
            } else if (tabName === 'logs') {
                loadLogs();
            }
        }

        // å¯åŠ¨å·¥ä½œæµ (æ–°çš„ä¸»è¦å¯åŠ¨å‡½æ•°ï¼Œæºå¸¦æäº¤é˜¶æ®µç”Ÿæˆçš„ thread_id)
        function startWorkflow() {
            console.log('å¯åŠ¨å·¥ä½œæµ:', flowName);
            addLog('info', 'æ­£åœ¨å¯åŠ¨å·¥ä½œæµ...');

            const flowId = "{{ flow_id }}";
            const apiUrl = `/api/flows/${flowId}/start`;
            addLog('debug', `è°ƒç”¨API: ${apiUrl}`);

            // ä»URLè·å–æäº¤é˜¶æ®µç”Ÿæˆçš„thread_id
            const urlParams = new URLSearchParams(window.location.search);
            const pendingThreadId = urlParams.get('thread_id') || null;

            // è°ƒç”¨åç«¯APIå¯åŠ¨å·¥ä½œæµï¼ˆå¦‚æœå­˜åœ¨pendingThreadIdåˆ™å¤ç”¨ï¼‰
            fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    input_data: {},
                    thread_id: pendingThreadId
                })
            })
            .then(async response => {
                addLog('debug', `APIå“åº”çŠ¶æ€: ${response.status}`);
                const data = await response.json();

                if (!response.ok) {
                    const errorMsg = data.detail || data.message || `HTTP ${response.status} é”™è¯¯`;
                    throw new Error(errorMsg);
                }
                return data;
            })
            .then(data => {
                console.log('APIå“åº”æ•°æ®:', data);

                if (data.thread_id) {
                    addLog('success', `âœ… å·¥ä½œæµå¯åŠ¨æˆåŠŸï¼Thread ID: ${data.thread_id}`);
                    updateStatus('running', 'å·¥ä½œæµè¿è¡Œä¸­...');
                    addLog('info', `ğŸ“‹ æµç¨‹ID: ${data.flow_id}`);
                    addLog('info', `ğŸ“‹ ç‰ˆæœ¬: ${data.version}`);
                    addLog('info', `ğŸ“‹ çŠ¶æ€: ${data.status}`);

                    if (data.inputs && Object.keys(data.inputs).length > 0) {
                        addLog('info', 'ğŸ“ è¾“å…¥æ•°æ®:');
                        displayInputData(data.inputs);
                    }

                    if (urlParams.get('form_data') === 'submitted') {
                        displayFormData(data.inputs || {});
                    }

                    startLogPolling(data.thread_id);
                } else {
                    const errorMsg = data.detail || data.message || 'æœªçŸ¥é”™è¯¯';
                    addLog('error', `âŒ å¯åŠ¨å¤±è´¥: ${errorMsg}`);
                    console.error('å¯åŠ¨å¤±è´¥è¯¦æƒ…:', data);
                }
            })
            .catch(error => {
                console.error('å¯åŠ¨å·¥ä½œæµå¤±è´¥:', error);
                addLog('error', `âŒ å¯åŠ¨å¤±è´¥: ${error.message}`);

                if (error.message.includes('404')) {
                    addLog('warning', 'ğŸ’¡ æç¤º: è¯·æ£€æŸ¥æµç¨‹IDæ˜¯å¦æ­£ç¡®ï¼Œæˆ–æµç¨‹æ˜¯å¦å·²å‘å¸ƒ');
                } else if (error.message.includes('500')) {
                    addLog('warning', 'ğŸ’¡ æç¤º: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·æ£€æŸ¥å·¥ä½œæµå®šä¹‰æˆ–è”ç³»ç®¡ç†å‘˜');
                } else if (error.message.includes('400')) {
                    addLog('warning', 'ğŸ’¡ æç¤º: è¯·æ±‚å‚æ•°é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ•°æ®æ ¼å¼');
                }
            });
        }

        // æ˜¾ç¤ºè¾“å…¥æ•°æ®ï¼ˆæ ¼å¼åŒ–åˆ°æ—¥å¿—ä¸­ï¼‰
        function displayInputData(inputData) {
            Object.entries(inputData).forEach(([key, value]) => {
                let displayValue;
                if (typeof value === 'object') {
                    displayValue = JSON.stringify(value, null, 2);
                } else {
                    displayValue = String(value);
                }
                addLog('info', `   ${key}: ${displayValue}`);
            });
        }

        // æ˜¾ç¤ºè¡¨å•æ•°æ®
        function displayFormData(formData) {
            const container = document.getElementById('form-data-display');
            if (container && Object.keys(formData).length > 0) {
                // æ ¼å¼åŒ–æ˜¾ç¤ºè¡¨å•æ•°æ®
                addLog('info', 'ğŸ“ æäº¤çš„è¡¨å•æ•°æ®:');

                Object.entries(formData).forEach(([key, value]) => {
                    let displayValue;
                    if (typeof value === 'object') {
                        displayValue = JSON.stringify(value, null, 2);
                    } else {
                        displayValue = String(value);
                    }
                    addLog('info', `   ${key}: ${displayValue}`);
                });

                // åŒæ—¶åœ¨è¡¨å•æ•°æ®å®¹å™¨ä¸­æ˜¾ç¤º
                let html = '<div style="background: #2a2a2a; color: #e0e0e0; padding: 15px; border-radius: 4px; margin-bottom: 10px; font-family: monospace;">';
                html += '<strong style="color: #4CAF50;">ğŸ“ æäº¤çš„è¡¨å•æ•°æ®:</strong><br><br>';

                Object.entries(formData).forEach(([key, value]) => {
                    const formattedValue = typeof value === 'object' ?
                        JSON.stringify(value, null, 2) : String(value);
                    html += `<div style="margin: 8px 0; padding: 5px; background: #333; border-radius: 3px;">`;
                    html += `<span style="color: #FF9800; font-weight: bold;">${key}:</span> `;
                    html += `<span style="color: #e0e0e0;">${formattedValue}</span>`;
                    html += `</div>`;
                });

                html += '</div>';
                container.innerHTML = html;
            }
        }

        // å¼€å§‹æ—¥å¿—è½®è¯¢
        function startLogPolling(threadId) {
            // è¿™é‡Œå¯ä»¥å®ç°æ—¥å¿—è½®è¯¢é€»è¾‘
            console.log('å¼€å§‹è½®è¯¢æ—¥å¿—ï¼ŒThread ID:', threadId);

            // æ¨¡æ‹Ÿæ—¥å¿—æ›´æ–°
            setTimeout(() => {
                addLog('info', 'å·¥ä½œæµèŠ‚ç‚¹å¼€å§‹æ‰§è¡Œ...');
            }, 1000);

            setTimeout(() => {
                addLog('info', 'å¤„ç†è¡¨å•æ•°æ®ä¸­...');
            }, 2000);

            setTimeout(() => {
                addLog('success', 'å·¥ä½œæµæ‰§è¡Œå®Œæˆ');
                updateStatus('idle', 'æ‰§è¡Œå®Œæˆ');
            }, 4000);
        }

        // å¯åŠ¨æµç¨‹ (ä¿æŒå‘åå…¼å®¹)
        function startFlow() {
            startWorkflow();
        }

        // æš‚åœæµç¨‹
        function pauseFlow() {
            console.log('æš‚åœæµç¨‹:', flowName);
            updateStatus('idle', 'æµç¨‹å·²æš‚åœ');
        }

        // åœæ­¢æµç¨‹
        function stopFlow() {
            console.log('åœæ­¢æµç¨‹:', flowName);
            updateStatus('idle', 'æµç¨‹å·²åœæ­¢');
        }

        // è§¦å‘æµç¨‹æ‰§è¡Œ
        function triggerFlow() {
            const input = document.getElementById('flow-input').value.trim();
            let inputData = {};
            
            if (input) {
                try {
                    inputData = JSON.parse(input);
                } catch (e) {
                    alert('è¾“å…¥æ•°æ®æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„JSONæ ¼å¼');
                    return;
                }
            }

            console.log('è§¦å‘æµç¨‹æ‰§è¡Œ:', flowName, inputData);
            updateStatus('running', 'æµç¨‹æ‰§è¡Œä¸­...');
            
            // æ¨¡æ‹Ÿæ‰§è¡Œè¿‡ç¨‹
            setTimeout(() => {
                updateStatus('idle', 'æ‰§è¡Œå®Œæˆ');
                addLog('info', `æµç¨‹ ${flowName} æ‰§è¡Œå®Œæˆ`);
            }, 2000);
        }

        // æ›´æ–°çŠ¶æ€
        function updateStatus(status, message) {
            const statusInfo = document.getElementById('status-info');
            const statusClass = `status-${status}`;
            const now = new Date().toLocaleString();
            
            statusInfo.innerHTML = `
                <p>å½“å‰çŠ¶æ€: <span class="status ${statusClass}">${getStatusText(status)}</span></p>
                <p>æœ€åæ‰§è¡Œ: ${now}</p>
                <p>æ¶ˆæ¯: ${message}</p>
            `;
        }

        // è·å–çŠ¶æ€æ–‡æœ¬
        function getStatusText(status) {
            const statusMap = {
                'idle': 'ç©ºé—²',
                'running': 'è¿è¡Œä¸­',
                'error': 'é”™è¯¯'
            };
            return statusMap[status] || status;
        }

        // åˆ·æ–°çŠ¶æ€
        function refreshStatus() {
            console.log('åˆ·æ–°çŠ¶æ€');
            updateStatus('idle', 'çŠ¶æ€å·²åˆ·æ–°');
        }

        // åŠ è½½æ¨¡æ¿æ–‡ä»¶
        function loadTemplates() {
            const container = document.getElementById('templates-list');
            container.innerHTML = `
                <ul class="file-list">
                    <li>
                        <span><span class="file-icon">ğŸ“„</span>template1.html</span>
                        <button class="btn btn-secondary" onclick="viewFile('templates', 'template1.html')">æŸ¥çœ‹</button>
                    </li>
                    <li>
                        <span><span class="file-icon">ğŸ“„</span>template2.html</span>
                        <button class="btn btn-secondary" onclick="viewFile('templates', 'template2.html')">æŸ¥çœ‹</button>
                    </li>
                </ul>
            `;
        }

        // åŠ è½½è„šæœ¬æ–‡ä»¶
        function loadScripts() {
            const container = document.getElementById('scripts-list');
            container.innerHTML = `
                <ul class="file-list">
                    <li>
                        <span><span class="file-icon">ğŸ“œ</span>script1.py</span>
                        <button class="btn btn-secondary" onclick="viewFile('scripts', 'script1.py')">æŸ¥çœ‹</button>
                    </li>
                    <li>
                        <span><span class="file-icon">ğŸ“œ</span>script2.sh</span>
                        <button class="btn btn-secondary" onclick="viewFile('scripts', 'script2.sh')">æŸ¥çœ‹</button>
                    </li>
                </ul>
            `;
        }

        // æŸ¥çœ‹æ–‡ä»¶
        function viewFile(type, filename) {
            console.log('æŸ¥çœ‹æ–‡ä»¶:', type, filename);
            alert(`æŸ¥çœ‹æ–‡ä»¶: ${type}/${filename}`);
        }

        // åŠ è½½æ—¥å¿—
        function loadLogs() {
            const container = document.getElementById('logs-container');
            const logs = [
                { time: '2025-10-22 17:18:00', level: 'INFO', message: `æµç¨‹ ${flowName} åˆå§‹åŒ–å®Œæˆ` },
                { time: '2025-10-22 17:18:01', level: 'INFO', message: 'ç­‰å¾…è§¦å‘æ‰§è¡Œ...' }
            ];

            let html = '';
            logs.forEach(log => {
                const logClass = `log-${log.level.toLowerCase()}`;
                html += `<div class="log-entry ${logClass}">[${log.time}] [${log.level}] ${log.message}</div>`;
            });

            container.innerHTML = html || '<p style="color: #9E9E9E;">æš‚æ— æ—¥å¿—è®°å½•</p>';
        }

        // æ·»åŠ æ—¥å¿—
        function addLog(level, message) {
            const container = document.getElementById('logs-container');
            const now = new Date().toLocaleString();

            // åˆ›å»ºå¸¦é¢œè‰²çš„æ—¥å¿—æ¡ç›®
            const logClass = `log-${level.toLowerCase()}`;
            const logEntry = `<div class="log-entry ${logClass}">[${now}] [${level.toUpperCase()}] ${message}</div>`;

            if (container.innerHTML.includes('æš‚æ— æ—¥å¿—è®°å½•')) {
                container.innerHTML = logEntry;
            } else {
                container.innerHTML += logEntry;
            }

            // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
            container.scrollTop = container.scrollHeight;
        }

        // æ¸…ç©ºæ—¥å¿—
        function clearLogs() {
            document.getElementById('logs-container').innerHTML = '<p style="color: #9E9E9E;">æš‚æ— æ—¥å¿—è®°å½•</p>';
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('æµç¨‹æ§åˆ¶å°åˆå§‹åŒ–å®Œæˆ:', flowContext);
            addLog('info', `æµç¨‹æ§åˆ¶å°å·²åŠ è½½: ${appName}/${flowName}`);
        });
    </script>
</body>
</html>