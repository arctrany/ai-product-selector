# Change: Scraperæ¶æ„ç»Ÿä¸€é‡æ„ä¼˜åŒ–

## Why

### ä»£ç è´¨é‡é—®é¢˜
é€šè¿‡æ·±åº¦ä»£ç å®¡æŸ¥å‘ç°ï¼Œå½“å‰ Scraper ç³»ç»Ÿï¼ˆOzonScraperã€CompetitorScraperã€SeerfarScraperï¼‰å­˜åœ¨ä¸¥é‡çš„æ¶æ„é—®é¢˜ï¼Œå½±å“ç³»ç»Ÿç¨³å®šæ€§ã€å¯ç»´æŠ¤æ€§å’Œæ€§èƒ½ï¼š

#### ğŸ”´ é«˜ä¼˜å…ˆçº§é—®é¢˜
1. **æ—¶åºä¸ä¸€è‡´å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®š**
   - å¤§é‡ä½¿ç”¨ç¡¬ç¼–ç  `time.sleep()` ç­‰å¾…ï¼Œå¯¼è‡´æ—¶åºä¸å¯æ§
   - å¼‚æ­¥æ“ä½œä¸åŒæ­¥åŒ…è£…æ–¹æ³•ä¹‹é—´å­˜åœ¨æ—¶åºå†²çª
   - é¡µé¢è·³è½¬éªŒè¯æ—¶æœºä¸å½“ï¼Œå®¹æ˜“å¯¼è‡´è¯¯åˆ¤å’Œå¤±è´¥é‡è¯•

2. **èŒè´£åˆ’åˆ†æ··ä¹±è¿åè®¾è®¡åŸåˆ™**
   - `OzonScraper` èŒè´£è¿‡é‡ï¼ŒåŒæ—¶è´Ÿè´£å•†å“æŠ“å–ã€ä»·æ ¼æå–ã€è·Ÿå–æ£€æµ‹ã€ERPæ•°æ®ç­‰å¤šä¸ªåŠŸèƒ½
   - `CompetitorScraper` ä¸ `OzonScraper` èŒè´£é‡å ï¼Œè·Ÿå–åŠŸèƒ½è¾¹ç•Œä¸æ¸…æ™°
   - `SeerfarScraper` é€šè¿‡è°ƒç”¨é“¾é—´æ¥ä½¿ç”¨è·Ÿå–é€»è¾‘ï¼Œå­˜åœ¨éšå¼ä¾èµ–
   - è¿åå•ä¸€èŒè´£åŸåˆ™ï¼Œå¢åŠ ç»´æŠ¤éš¾åº¦å’Œå‡ºé”™é£é™©

3. **ä»£ç å†—ä½™ä¸¥é‡å½±å“ä¸€è‡´æ€§**
   - **ä¸‰ä¸ª Scraper é‡å¤é€»è¾‘ä¸¥é‡**: æ•°æ®æå–ã€æ—¶åºæ§åˆ¶ã€é”™è¯¯å¤„ç†é€»è¾‘åœ¨ OzonScraperã€CompetitorScraperã€SeerfarScraper ä¸­é‡å¤å®ç°
   - ä»·æ ¼æå–é€»è¾‘å­˜åœ¨ä¸ä¸€è‡´é£é™©ï¼Œæ¯ä¸ª Scraper éƒ½æœ‰è‡ªå·±çš„å®ç°
   - é€‰æ‹©å™¨é…ç½®æ¨¡å¼é‡å¤ï¼ŒSeerfarSelectorsã€OzonSelectors é‡‡ç”¨ç›¸ä¼¼ä½†ä¸ç»Ÿä¸€çš„è®¾è®¡
   - æ•°æ®éªŒè¯å’Œæ–‡æœ¬å¤„ç†é€»è¾‘é‡å¤ï¼Œå¢åŠ ç»´æŠ¤æˆæœ¬

#### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§é—®é¢˜
1. **æ¨¡å—ä¾èµ–å…³ç³»å¤æ‚**
   - SeerfarScraper â†’ OzonScraper â†’ CompetitorScraper è°ƒç”¨é“¾å¤æ‚
   - å­˜åœ¨æ½œåœ¨å¾ªç¯ä¾èµ–é£é™©ï¼Œç¼ºä¹æŠ½è±¡å±‚
   - é…ç½®ç®¡ç†åˆ†æ•£ï¼šSeerfarSelectorsã€OzonSelectorsã€CompetitorSelectors å„è‡ªç‹¬ç«‹

2. **æ¥å£è®¾è®¡ä¸ä¸€è‡´**
   - ä¸‰ä¸ªæŠ“å–å™¨çš„æ–¹æ³•å‘½åå’Œè¿”å›æ ¼å¼ä¸ç»Ÿä¸€
   - ç¼ºä¹æ ‡å‡†çš„æ•°æ®äº¤æ¢æ ¼å¼å’Œé”™è¯¯å¤„ç†ç­–ç•¥

3. **æµ‹è¯•è¦†ç›–ä¸¥é‡ä¸å‡**
   - **SeerfarScraper æµ‹è¯•è¦†ç›–ç‡å‡ ä¹ä¸º 0%**ï¼Œå­˜åœ¨é‡å¤§è´¨é‡é£é™©
   - æµ‹è¯•ä»£ç å†—ä½™ï¼šæµè§ˆå™¨åˆå§‹åŒ–ã€Mock æ¨¡å¼ã€æ•°æ®éªŒè¯é€»è¾‘é‡å¤
   - ç¼ºä¹é›†æˆæµ‹è¯•ï¼Œæ— æ³•éªŒè¯å¤šä¸ª Scraper ååŒå·¥ä½œ

### ä¸šåŠ¡å½±å“
- **ç¨³å®šæ€§é—®é¢˜**: æ—¶åºä¸ä¸€è‡´å¯¼è‡´è·Ÿå–æ£€æµ‹å¤±è´¥ç‡é«˜ï¼ŒSeerfarScraper ç¼ºä¹æµ‹è¯•ä¿éšœ
- **ç»´æŠ¤æˆæœ¬**: ä¸‰ä¸ª Scraper çš„èŒè´£æ··ä¹±å’Œä»£ç å†—ä½™ä½¿å¾— bug ä¿®å¤å’ŒåŠŸèƒ½æ‰©å±•å›°éš¾
- **æ€§èƒ½é—®é¢˜**: ä¸åˆç†çš„ç­‰å¾…æœºåˆ¶å’Œé‡å¤é€»è¾‘å½±å“æ•´ä½“æŠ“å–æ•ˆç‡
- **å¼€å‘æ•ˆç‡**: æ¶æ„å¤æ‚æ€§å’Œç¼ºä¹ç»Ÿä¸€æ ‡å‡†å¢åŠ æ–°åŠŸèƒ½å¼€å‘éš¾åº¦
- **è´¨é‡é£é™©**: SeerfarScraper å‡ ä¹æ— æµ‹è¯•è¦†ç›–ï¼Œç”Ÿäº§ç¯å¢ƒå­˜åœ¨æœªçŸ¥é£é™©

## What Changes

### æ ¸å¿ƒæ¶æ„é‡æ„
1. **ç»Ÿä¸€æ—¶åºæ§åˆ¶æœºåˆ¶**
   - ç§»é™¤æ‰€æœ‰ Scraper ä¸­çš„ç¡¬ç¼–ç  `time.sleep()` è°ƒç”¨
   - åˆ›å»ºç»Ÿä¸€çš„ `WaitUtils` å·¥å…·ç±»ï¼Œä¸º OzonScraperã€CompetitorScraperã€SeerfarScraper æä¾›æ˜¾å¼ç­‰å¾…
   - å®ç°é…ç½®åŒ–çš„è¶…æ—¶æ§åˆ¶å’Œé‡è¯•æœºåˆ¶ï¼Œæ”¯æŒä¸åŒå¹³å°å·®å¼‚

2. **ä¸‰å±‚æ¶æ„ç»Ÿä¸€è®¾è®¡**
   - **æ•°æ®å±‚**: ç»Ÿä¸€ `ScrapingResult` æ•°æ®æ ¼å¼ï¼Œé€‚ç”¨äºæ‰€æœ‰ Scraper
   - **æœåŠ¡å±‚**: `SeerfarScraper`ã€`OzonScraper`ã€`CompetitorScraper` èŒè´£é‡æ–°åˆ’åˆ†
   - **å·¥å…·å±‚**: `WaitUtils`ã€`ScrapingUtils` ä¸ºæ‰€æœ‰ Scraper æä¾›ç»Ÿä¸€æœåŠ¡

3. **èŒè´£é‡æ–°åˆ†ç¦»ä¸é‡æ„**
   - **SeerfarScraper**: ä¸“æ³¨ Seerfar å¹³å°æ•°æ®æ”¶é›†ï¼Œè°ƒç”¨ç»Ÿä¸€æœåŠ¡æ¥å£
   - **OzonScraper**: ä¸“æ³¨ OZON åŸºç¡€å•†å“ä¿¡æ¯æŠ“å–ï¼Œç§»é™¤è·Ÿå–é€»è¾‘
   - **CompetitorDetectionService**: ç‹¬ç«‹çš„è·Ÿå–æ£€æµ‹æœåŠ¡ï¼Œç»Ÿä¸€è·Ÿå–é€»è¾‘
   - **CompetitorScraper**: ä¸“æ³¨è·Ÿå–åº—é“ºæ•°æ®æŠ“å–

4. **æ¶ˆé™¤ä¸‰é‡ä»£ç å†—ä½™**
   - åˆ›å»ºç»Ÿä¸€çš„ `ScrapingUtils` å·¥å…·ç±»æ•´åˆä¸‰ä¸ª Scraper çš„é‡å¤é€»è¾‘
   - ç»Ÿä¸€ä»·æ ¼æå–ã€æ•°æ®éªŒè¯ã€æ–‡æœ¬æ¸…ç†ç­‰å…¬å…±åŠŸèƒ½
   - å»ºç«‹ `BaseScrapingConfig` åŸºç±»ï¼ŒSeerfarSelectorsã€OzonSelectors ç»§æ‰¿ç»Ÿä¸€æ¥å£

5. **å»ºç«‹ç»Ÿä¸€æµ‹è¯•æ¡†æ¶**
   - åˆ›å»º `BaseScraperTest` ç»Ÿä¸€æµ‹è¯•åŸºç±»ï¼Œæ¶ˆé™¤æµ‹è¯•ä»£ç å†—ä½™
   - **ç´§æ€¥è¡¥é½ SeerfarScraper æµ‹è¯•è¦†ç›–**ï¼Œä» 0% æå‡åˆ° 95%+
   - å»ºç«‹é›†æˆæµ‹è¯•å¥—ä»¶ï¼ŒéªŒè¯å¤š Scraper ååŒå·¥ä½œ

### å…·ä½“æŠ€æœ¯å®ç°
#### æ–°å¢æ ¸å¿ƒç»„ä»¶
```python
# 1. ç»Ÿä¸€æ—¶åºæ§åˆ¶å·¥å…·
class WaitUtils:
    @staticmethod
    def wait_for_element_visible(page, selector: str, timeout: int = 30):
        """ç­‰å¾…å…ƒç´ å¯è§"""
        pass
    
    @staticmethod
    def wait_for_url_change(page, original_url: str, timeout: int = 30) -> bool:
        """ç­‰å¾…URLå˜åŒ–"""
        pass

# 2. ç‹¬ç«‹è·Ÿå–æ£€æµ‹æœåŠ¡
class CompetitorDetectionService:
    def detect_competitors(self, page):
        """æ£€æµ‹è·Ÿå–å•†å“"""
        pass
    
    def extract_competitor_data(self, competitors):
        """æå–è·Ÿå–æ•°æ®"""
        pass

# 3. ç»Ÿä¸€æŠ“å–å·¥å…·ç±»
class ScrapingUtils:
    @staticmethod
    def extract_price(element, selectors: list):
        """ç»Ÿä¸€ä»·æ ¼æå–é€»è¾‘"""
        pass
    
    @staticmethod
    def validate_price(price) -> bool:
        """ä»·æ ¼éªŒè¯"""
        pass
    
    @staticmethod
    def clean_text(text: str) -> str:
        """æ–‡æœ¬æ¸…ç†"""
        pass

# 4. æ ‡å‡†æ•°æ®æ ¼å¼
class ScrapingResult:
    def __init__(self, success: bool, data: dict, error_message: str = None):
        self.success = success
        self.data = data
        self.error_message = error_message
```

#### é‡æ„ç°æœ‰ç»„ä»¶
- **SeerfarScraper**: ä½¿ç”¨ç»Ÿä¸€å·¥å…·ç±»ï¼Œä¸“æ³¨ Seerfar æ•°æ®æ”¶é›†
- **OzonScraper**: ç§»é™¤è·Ÿå–ç›¸å…³é€»è¾‘ï¼Œä¸“æ³¨å•†å“åŸºç¡€ä¿¡æ¯æŠ“å–
- **CompetitorScraper**: é‡æ„ä¸ºçº¯ç²¹çš„è·Ÿå–åº—é“ºä¿¡æ¯æŠ“å–å™¨
- **é…ç½®ç®¡ç†**: å»ºç«‹ BaseScrapingConfigï¼Œä¸‰ä¸ª Scraper é…ç½®ç»§æ‰¿ç»Ÿä¸€æ¥å£

### ç ´åæ€§å˜æ›´
**âš ï¸ æœ‰é™çš„ç ´åæ€§å˜æ›´**ï¼š
- `OzonScraper.scrape()` æ–¹æ³•ç­¾åä¿æŒå…¼å®¹ï¼Œä½†å†…éƒ¨å®ç°é‡æ„
- æ–°å¢å¯é€‰å‚æ•°ç”¨äºæ§åˆ¶è·Ÿå–æ£€æµ‹è¡Œä¸º
- è¿”å›å€¼ç»“æ„ä¿æŒå…¼å®¹ï¼Œä»…æ–°å¢å¯é€‰å­—æ®µ

## Impact

### å½±å“çš„ Specs
- **ozon-scraper**: é‡æ„æ ¸å¿ƒæŠ“å–é€»è¾‘ï¼Œåˆ†ç¦»è·Ÿå–æ£€æµ‹èŒè´£ï¼Œä½¿ç”¨ç»Ÿä¸€å·¥å…·ç±»
- **æ–°å¢ competitor-detection**: ç‹¬ç«‹çš„è·Ÿå–æ£€æµ‹å’Œå¤„ç†èƒ½åŠ›è§„èŒƒ
- **æ–°å¢ seerfar-scraper**: SeerfarScraper é‡æ„è§„èŒƒï¼Œç»Ÿä¸€æ¶æ„å’Œæµ‹è¯•è¦†ç›–

### å½±å“çš„ä»£ç æ–‡ä»¶
#### æ ¸å¿ƒå˜æ›´
- `common/scrapers/seerfar_scraper.py` - é‡æ„ï¼Œä½¿ç”¨ç»Ÿä¸€å·¥å…·ç±»å’Œæ—¶åºæ§åˆ¶
- `common/scrapers/ozon_scraper.py` - é‡æ„ï¼Œç§»é™¤è·Ÿå–é€»è¾‘
- `common/scrapers/competitor_scraper.py` - é‡æ„ï¼Œä¸“æ³¨è·Ÿå–æ•°æ®æŠ“å–
- `common/config/seerfar_selectors_config.py` - é‡æ„ä¸ºç»§æ‰¿ BaseScrapingConfig
- `common/config/ozon_selectors_config.py` - é‡æ„é…ç½®ç»§æ‰¿å…³ç³»

#### æ–°å¢æ–‡ä»¶
- `common/services/competitor_detection_service.py` - è·Ÿå–æ£€æµ‹æœåŠ¡
- `common/utils/scraping_utils.py` - ç»Ÿä¸€æŠ“å–å·¥å…·ç±»
- `common/utils/wait_utils.py` - ç»Ÿä¸€æ—¶åºæ§åˆ¶å·¥å…·
- `common/models/scraping_result.py` - æ ‡å‡†æ•°æ®ä¼ è¾“å¯¹è±¡

#### é…ç½®æ–‡ä»¶
- `common/config/base_scraping_config.py` - åŸºç¡€é…ç½®ç±»
- æ›´æ–° SeerfarSelectorsã€OzonSelectorsã€CompetitorSelectors å»ºç«‹ç»§æ‰¿å…³ç³»

#### æµ‹è¯•æ–‡ä»¶ï¼ˆæ€¥éœ€è¡¥é½ï¼‰
- `tests/test_seerfar_scraper.py` - **æ–°å¢**ï¼ŒSeerfarScraper å®Œæ•´æµ‹è¯•è¦†ç›–
- `tests/test_base_scraper_test.py` - **æ–°å¢**ï¼Œç»Ÿä¸€æµ‹è¯•åŸºç±»
- `tests/test_scraping_integration.py` - **æ–°å¢**ï¼Œå¤š Scraper é›†æˆæµ‹è¯•
- æ›´æ–°ç°æœ‰ OzonScraper å’Œ CompetitorScraper æµ‹è¯•ä½¿ç”¨ç»Ÿä¸€æ¡†æ¶

### æ€§èƒ½å½±å“
#### é¢„æœŸæ”¹è¿›
- **æ—¶åºä¼˜åŒ–**: æ˜¾å¼ç­‰å¾…æ›¿ä»£ç¡¬ç¼–ç ç­‰å¾…ï¼Œæé«˜å“åº”æ•ˆç‡ 20-30%
- **å‡å°‘é‡è¯•**: æ—¶åºæ§åˆ¶æ”¹è¿›å‡å°‘å› è¶…æ—¶å¯¼è‡´çš„å¤±è´¥é‡è¯•
- **ä»£ç å¤ç”¨**: ç»Ÿä¸€å·¥å…·ç±»å‡å°‘é‡å¤è®¡ç®—å’Œå†…å­˜å ç”¨

#### é£é™©è¯„ä¼°
- **é‡æ„é£é™©**: æ¶æ„é‡æ„å¯èƒ½å¼•å…¥æ–°çš„bug - **é£é™©ç­‰çº§: ä¸­**ï¼Œé€šè¿‡å…¨é¢æµ‹è¯•è¦†ç›–
- **å…¼å®¹æ€§é£é™©**: æ¥å£å˜æ›´å½±å“ç°æœ‰è°ƒç”¨ - **é£é™©ç­‰çº§: ä½**ï¼Œä¿æŒå‘åå…¼å®¹
- **æ€§èƒ½å›å½’**: æ–°æ¶æ„å¯èƒ½å½±å“æ€§èƒ½ - **é£é™©ç­‰çº§: ä½**ï¼Œé¢„æœŸæ€§èƒ½æå‡

## Migration Plan

### åˆ†é˜¶æ®µå®æ–½ç­–ç•¥
#### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€è®¾æ–½å»ºè®¾ï¼ˆ1-2å‘¨ï¼‰
1. åˆ›å»ºç»Ÿä¸€å·¥å…·ç±»ï¼ˆWaitUtils, ScrapingUtilsï¼‰
2. å»ºç«‹æ ‡å‡†æ•°æ®æ ¼å¼ï¼ˆScrapingResultï¼‰
3. é‡æ„é…ç½®ç®¡ç†ç³»ç»Ÿ

#### ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒé€»è¾‘é‡æ„ï¼ˆ1-2å‘¨ï¼‰
1. é‡æ„ OzonScraperï¼Œåˆ†ç¦»è·Ÿå–é€»è¾‘
2. åˆ›å»º CompetitorDetectionService
3. æ›´æ–° CompetitorScraper ä½¿ç”¨æ–°æ¶æ„

#### ç¬¬ä¸‰é˜¶æ®µï¼šæµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆ3-5å¤©ï¼‰
1. å…¨é¢å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
2. æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
3. æ–‡æ¡£æ›´æ–°å’Œä»£ç å®¡æŸ¥

### å‘åå…¼å®¹æ€§ä¿éšœ
- ä¿æŒç°æœ‰APIæ¥å£ä¸å˜
- æ–°å¢åŠŸèƒ½é€šè¿‡å¯é€‰å‚æ•°æ§åˆ¶
- æä¾›è¿‡æ¸¡æœŸæ”¯æŒï¼Œé€æ­¥è¿ç§»

## Success Metrics

### ä»£ç è´¨é‡æŒ‡æ ‡
- âœ… **æ•´ä½“å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 95%**ï¼ˆSeerfarScraper ä» 0% æå‡åˆ° 95%+ï¼‰
- âœ… **SeerfarScraper æµ‹è¯•è¦†ç›–ç‡ â‰¥ 95%**ï¼ˆå½“å‰å‡ ä¹ä¸º 0%ï¼Œæ€¥éœ€è¡¥é½ï¼‰
- âœ… é›†æˆæµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%ï¼ˆæ–°å¢å¤š Scraper ååŒæµ‹è¯•ï¼‰
- âœ… ä»£ç å¤æ‚åº¦é™ä½ 30%ï¼ˆé€šè¿‡ä¸‰ä¸ª Scraper èŒè´£åˆ†ç¦»ï¼‰
- âœ… ä»£ç é‡å¤ç‡ < 5%ï¼ˆæ¶ˆé™¤ä¸‰é‡å†—ä½™é€»è¾‘ï¼‰
- âœ… é™æ€ä»£ç åˆ†æ 0 ä¸¥é‡é—®é¢˜

### æ€§èƒ½æŒ‡æ ‡  
- âœ… è·Ÿå–æ£€æµ‹æˆåŠŸç‡ â‰¥ 95%ï¼ˆæ—¶åºä¼˜åŒ–ï¼‰
- âœ… å¹³å‡å“åº”æ—¶é—´æå‡ 20-30%
- âœ… è¶…æ—¶é‡è¯•æ¬¡æ•°å‡å°‘ 50%
- âœ… å†…å­˜ä½¿ç”¨ä¼˜åŒ– 15-20%

### å¯ç»´æŠ¤æ€§æŒ‡æ ‡
- âœ… æ–°åŠŸèƒ½å¼€å‘æ—¶é—´ç¼©çŸ­ 40%
- âœ… Bugä¿®å¤æ—¶é—´ç¼©çŸ­ 50%
- âœ… ä»£ç å®¡æŸ¥é€šè¿‡ç‡ â‰¥ 95%
- âœ… æ‰€æœ‰ç°æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡ï¼Œ0å›å½’é—®é¢˜