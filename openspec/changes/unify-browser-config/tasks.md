# 统一浏览器配置管理 - 任务列表

## 任务概述
本变更采用简化方案，通过别名和兼容性设计实现配置统一，避免破坏性变更。

## 任务列表

### ✅ 阶段 1：Proposal 创建
- [x] 创建 proposal.md
- [x] 创建 tasks.md
- [ ] 创建 design.md（可选，本次变更较简单可跳过）

### 📝 阶段 2：配置类重构

#### Task 2.1：在 common/config.py 中创建 BrowserConfig 类
**优先级**: P0  
**预计时间**: 2小时  
**依赖**: 无

**具体步骤**:
1. 在 `common/config.py` 中定义新的 BrowserConfig 类
2. 包含所有浏览器相关配置字段：
   - browser_type: 浏览器类型
   - headless: 是否无头模式
   - window_width/height: 窗口尺寸
   - timeout_seconds: 超时时间
   - max_retries: 最大重试次数
   - required_login_domains: 必需登录域名列表
   - debug_port: 调试端口
3. 添加配置验证方法
4. 添加配置序列化/反序列化方法

**验证标准**:
- BrowserConfig 类定义完整
- 所有字段都有类型注解和默认值
- 配置验证逻辑正确

#### Task 2.2：将 ScrapingConfig 改为 BrowserConfig 的别名
**优先级**: P0  
**预计时间**: 1小时  
**依赖**: Task 2.1

**具体步骤**:
1. 保留 ScrapingConfig 类定义
2. 将 ScrapingConfig 改为继承或等同于 BrowserConfig
3. 添加 @deprecated 装饰器（如果 Python 版本支持）
4. 在类文档字符串中标注废弃信息

**验证标准**:
- ScrapingConfig 仍然可用
- ScrapingConfig 和 BrowserConfig 功能等同
- 废弃标记清晰可见

#### Task 2.3：更新 GoodStoreSelectorConfig 配置加载逻辑
**优先级**: P0  
**预计时间**: 2小时  
**依赖**: Task 2.1, Task 2.2

**具体步骤**:
1. 修改 `from_dict()` 方法，支持读取 `browser` 字段
2. 保持对 `scraping` 字段的向后兼容
3. 优先级：`browser` > `scraping`
4. 使用 `scraping` 字段时输出警告日志
5. 更新 `to_dict()` 方法，输出 `browser` 字段

**验证标准**:
- 能正确加载包含 `browser` 字段的配置
- 能正确加载包含 `scraping` 字段的配置（向后兼容）
- 使用 `scraping` 时输出警告日志
- 导出的配置使用 `browser` 字段

### 🧪 阶段 3：测试编写

#### Task 3.1：编写配置加载单元测试
**优先级**: P0  
**预计时间**: 2小时  
**依赖**: Task 2.3

**测试用例**:
1. 测试加载 `browser` 字段配置
2. 测试加载 `scraping` 字段配置（向后兼容）
3. 测试同时存在两个字段时的优先级
4. 测试配置验证逻辑
5. 测试警告日志输出
6. 测试配置序列化/反序列化

**验证标准**:
- 所有测试用例通过
- 测试覆盖率 > 90%

#### Task 3.2：编写集成测试
**优先级**: P1  
**预计时间**: 2小时  
**依赖**: Task 3.1

**测试场景**:
1. 使用新配置格式运行完整流程
2. 使用旧配置格式运行完整流程
3. 验证浏览器服务正常工作
4. 验证抓取器正常工作

**验证标准**:
- 集成测试通过
- 新旧配置都能正常工作

### 📚 阶段 4：文档更新

#### Task 4.1：更新配置文件示例
**优先级**: P1  
**预计时间**: 1小时  
**依赖**: Task 2.3

**具体步骤**:
1. 更新 `config.json` 示例文件
2. 更新 `test_system_config.json`
3. 在注释中说明新旧格式的区别
4. 标注推荐使用新格式

**验证标准**:
- 示例文件使用新格式
- 注释清晰说明迁移方法

#### Task 4.2：编写迁移指南
**优先级**: P1  
**预计时间**: 1小时  
**依赖**: Task 4.1

**内容包括**:
1. 为什么要迁移
2. 新旧配置的对比
3. 迁移步骤说明
4. 常见问题解答

**验证标准**:
- 迁移指南清晰易懂
- 包含具体的代码示例

#### Task 4.3：更新代码注释
**优先级**: P2  
**预计时间**: 1小时  
**依赖**: Task 2.3

**具体步骤**:
1. 在 ScrapingConfig 类上添加废弃注释
2. 在相关方法上添加迁移提示
3. 更新模块文档字符串

**验证标准**:
- 所有废弃信息都有清晰标注
- 提供了迁移建议

### 🔍 阶段 5：代码审查和验证

#### Task 5.1：运行所有测试
**优先级**: P0  
**预计时间**: 30分钟  
**依赖**: Task 3.1, Task 3.2

**验证项**:
- 所有单元测试通过
- 所有集成测试通过
- 无新增的 linter 错误
- 无性能回归

**验证标准**:
- 测试通过率 100%
- 无阻塞性问题

#### Task 5.2：代码审查
**优先级**: P0  
**预计时间**: 1小时  
**依赖**: Task 5.1

**审查要点**:
- 代码风格符合规范
- 向后兼容性保证
- 错误处理完善
- 日志输出合理
- 文档完整

**验证标准**:
- 通过代码审查
- 所有反馈已处理

### 🚀 阶段 6：部署和监控

#### Task 6.1：合并代码
**优先级**: P0  
**预计时间**: 30分钟  
**依赖**: Task 5.2

**具体步骤**:
1. 创建 Pull Request
2. 通过 CI/CD 检查
3. 合并到主分支
4. 打标签

**验证标准**:
- 代码成功合并
- CI/CD 检查通过

#### Task 6.2：监控和反馈收集
**优先级**: P1  
**预计时间**: 持续  
**依赖**: Task 6.1

**监控项**:
- 警告日志输出频率
- 配置加载错误
- 用户反馈

**验证标准**:
- 无严重问题报告
- 用户反馈积极

## 任务依赖关系

```
Task 2.1 (创建 BrowserConfig)
    ↓
Task 2.2 (ScrapingConfig 别名)
    ↓
Task 2.3 (更新配置加载)
    ↓
Task 3.1 (单元测试) → Task 3.2 (集成测试)
    ↓                      ↓
Task 4.1 (更新示例) → Task 4.2 (迁移指南) → Task 4.3 (更新注释)
    ↓
Task 5.1 (运行测试) → Task 5.2 (代码审查)
    ↓
Task 6.1 (合并代码) → Task 6.2 (监控反馈)
```

## 时间估算

- **阶段 1**: 已完成
- **阶段 2**: 5小时
- **阶段 3**: 4小时
- **阶段 4**: 3小时
- **阶段 5**: 1.5小时
- **阶段 6**: 0.5小时 + 持续监控

**总计**: 约 14 小时（不含监控）

## 风险和缓解

### 风险 1：配置加载逻辑复杂化
**影响**: 中  
**概率**: 低  
**缓解措施**: 
- 编写详细的单元测试
- 添加清晰的日志输出
- 代码审查重点关注

### 风险 2：用户混淆新旧配置
**影响**: 低  
**概率**: 中  
**缓解措施**:
- 提供清晰的迁移指南
- 警告日志提供具体建议
- 文档中明确标注

### 风险 3：第三方依赖问题
**影响**: 低  
**概率**: 低  
**缓解措施**:
- 保持长期向后兼容
- 不强制立即迁移
- 提供充足过渡期

## 完成标准

- [ ] 所有 P0 任务完成
- [ ] 所有测试通过
- [ ] 文档更新完成
- [ ] 代码审查通过
- [ ] 成功部署到生产环境
- [ ] 无严重问题报告
