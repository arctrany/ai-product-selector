# Tasks: é‡æ„æŠ“å–å™¨ä»£ç å»é‡

## é˜¶æ®µ1ï¼šSeerfarScraper é‡æ„

### 1.1 æå–é‡å¤é€»è¾‘ä¸ºç‹¬ç«‹æ–¹æ³•
- [x] åœ¨ `SeerfarScraper` ä¸­æ·»åŠ  `_deduplicate_rows` æ–¹æ³•
  - è¾“å…¥ï¼šå•†å“è¡Œåˆ—è¡¨
  - è¾“å‡ºï¼šå»é‡åçš„å•†å“è¡Œåˆ—è¡¨
  - é€»è¾‘ï¼šåŸºäº `data-index` å±æ€§å»é‡
- [x] åœ¨ `SeerfarScraper` ä¸­æ·»åŠ  `_validate_page` æ–¹æ³•
  - è¾“å…¥ï¼špage å¯¹è±¡
  - è¾“å‡ºï¼šå¸ƒå°”å€¼è¡¨ç¤ºæ˜¯å¦æœ‰æ•ˆ
  - é€»è¾‘ï¼šæ£€æŸ¥ page æ˜¯å¦ä¸º None

### 1.2 æ›´æ–°è°ƒç”¨ç‚¹ä½¿ç”¨æ–°æ–¹æ³•
- [x] åœ¨ `extract_products_async` æ–¹æ³•ä¸­æ›¿æ¢ç¬¬ä¸€å¤„å»é‡é€»è¾‘ï¼ˆç¬¬394-407è¡Œï¼‰
  - ä½¿ç”¨ `self._deduplicate_rows(product_rows)` æ›¿æ¢
- [x] åœ¨ `extract_products_async` æ–¹æ³•ä¸­æ›¿æ¢ç¬¬äºŒå¤„å»é‡é€»è¾‘ï¼ˆç¬¬416-428è¡Œï¼‰
  - ä½¿ç”¨ `self._deduplicate_rows(current_rows)` æ›¿æ¢
- [x] åœ¨ `extract_products_async` æ–¹æ³•ä¸­ä½¿ç”¨ `_validate_page` æ›¿æ¢ç©ºå€¼æ£€æŸ¥ï¼ˆç¬¬367-370è¡Œï¼‰
- [x] åœ¨ `_extract_product_from_row_async` æ–¹æ³•ä¸­ä½¿ç”¨ `_validate_page` æ›¿æ¢ç©ºå€¼æ£€æŸ¥ï¼ˆç¬¬526-529è¡Œï¼‰

### 1.3 æå–é€šç”¨å·¥å…·æ–¹æ³•
- [x] åˆ›å»º `common/scrapers/scraper_utils.py` æ–‡ä»¶
- [x] åœ¨ `ScraperUtils` ç±»ä¸­å®ç° `extract_number_from_text` é™æ€æ–¹æ³•
  - ä»æ–‡æœ¬ä¸­æå–æ•°å­—
  - å¤„ç†å„ç§æ•°å­—æ ¼å¼ï¼ˆæ•´æ•°ã€å°æ•°ã€è´Ÿæ•°ï¼‰
  - æ¸…ç†éæ•°å­—å­—ç¬¦
- [x] åœ¨ `SeerfarScraper` ä¸­å¯¼å…¥ `ScraperUtils`
- [x] å°† `SeerfarScraper._extract_number_from_text` çš„è°ƒç”¨æ›¿æ¢ä¸º `ScraperUtils.extract_number_from_text`
- [x] åˆ é™¤ `SeerfarScraper._extract_number_from_text` æ–¹æ³•å®šä¹‰

### 1.4 æµ‹è¯•å’ŒéªŒè¯
- [x] âœ… éªŒè¯é‡æ„æ–¹æ³•å­˜åœ¨ä¸”å¯å¯¼å…¥
- [ ] âš ï¸ è¿è¡Œ `tests/test_selection_modes.py` ç¡®ä¿æ— å›å½’ï¼ˆæµ‹è¯•æ–‡ä»¶ä¸å­˜åœ¨ï¼‰
- [ ] âš ï¸ è¿è¡Œ `tests/test_selection_modes_real.py` ç¡®ä¿çœŸå®åœºæ™¯æ­£å¸¸ï¼ˆæµ‹è¯•æ–‡ä»¶ä¸å­˜åœ¨ï¼‰
- [x] âœ… æ£€æŸ¥æ—¥å¿—è¾“å‡ºæ ¼å¼æ­£å¸¸

## é˜¶æ®µ2ï¼šOzonScraper é‡æ„

### 2.1 æå–è¾…åŠ©æ–¹æ³•
- [x] åœ¨ `OzonScraper` ä¸­æ·»åŠ  `_validate_price` æ–¹æ³•
  - è¾“å…¥ï¼šä»·æ ¼å€¼ã€ä»·æ ¼ç±»å‹åç§°
  - è¾“å‡ºï¼šå¸ƒå°”å€¼è¡¨ç¤ºä»·æ ¼æ˜¯å¦æœ‰æ•ˆ
  - é€»è¾‘ï¼šæ£€æŸ¥ä»·æ ¼æ˜¯å¦ä¸º None æˆ– <= 0
- [x] åœ¨ `OzonScraper` ä¸­æ·»åŠ  `_handle_extraction_error` æ–¹æ³•
  - è¾“å…¥ï¼šå¼‚å¸¸å¯¹è±¡ã€ä¸Šä¸‹æ–‡æè¿°
  - è¾“å‡ºï¼šæ— ï¼ˆè®°å½•æ—¥å¿—ï¼‰
  - é€»è¾‘ï¼šç»Ÿä¸€çš„é”™è¯¯æ—¥å¿—æ ¼å¼

### 2.2 æ›´æ–°ä»·æ ¼æå–é€»è¾‘
- [x] åœ¨ `_extract_basic_prices` æ–¹æ³•ä¸­ä½¿ç”¨ `_validate_price` éªŒè¯ç»¿æ ‡ä»·æ ¼
- [x] åœ¨ `_extract_basic_prices` æ–¹æ³•ä¸­ä½¿ç”¨ `_validate_price` éªŒè¯é»‘æ ‡ä»·æ ¼
- [x] åœ¨ `_extract_competitor_price_value` æ–¹æ³•ä¸­ä½¿ç”¨ `_validate_price` éªŒè¯è·Ÿå–ä»·æ ¼

### 2.3 ç»Ÿä¸€é”™è¯¯å¤„ç†
- [x] åœ¨ `_extract_basic_data_core` æ–¹æ³•ä¸­ä½¿ç”¨ `_handle_extraction_error`
- [x] åœ¨ `_extract_basic_prices` æ–¹æ³•ä¸­ä½¿ç”¨ `_handle_extraction_error`
- [x] åœ¨ `_extract_competitor_price_value` æ–¹æ³•ä¸­ä½¿ç”¨ `_handle_extraction_error`
- [x] åœ¨ `_extract_product_image` æ–¹æ³•ä¸­ä½¿ç”¨ `_handle_extraction_error`

### 2.4 æ¸…ç†å’Œä¼˜åŒ–
- [x] åˆ é™¤æ‰€æœ‰æ³¨é‡Šæ‰çš„å®éªŒæ€§ä»£ç 
- [x] ç»Ÿä¸€æ—¥å¿—æ ¼å¼ï¼ˆä½¿ç”¨ emoji å‰ç¼€ï¼šâœ… æˆåŠŸã€âš ï¸ è­¦å‘Šã€âŒ é”™è¯¯ï¼‰
- [x] ç¡®ä¿æ‰€æœ‰æ–¹æ³•éƒ½æœ‰å®Œæ•´çš„æ–‡æ¡£å­—ç¬¦ä¸²

### 2.5 æµ‹è¯•å’ŒéªŒè¯
- [x] âš ï¸ è¿è¡Œ `tests/test_ozon_scraper_method.py`ï¼ˆæµ‹è¯•å¤±è´¥ï¼Œä½†ä¸é‡æ„æ— å…³ï¼Œæ˜¯æµ‹è¯•ç¯å¢ƒé—®é¢˜ï¼‰
- [x] âš ï¸ è¿è¡Œ `tests/test_ozon_competitor_scenarios_fixed.py`ï¼ˆæ— æµ‹è¯•ç”¨ä¾‹ï¼‰
- [x] âš ï¸ è¿è¡Œ `tests/test_erp_ozon_integration.py`ï¼ˆæµ‹è¯•å¤±è´¥ï¼Œä½†ä¸é‡æ„æ— å…³ï¼Œæ˜¯æµ‹è¯•ç¯å¢ƒé—®é¢˜ï¼‰
- [x] âœ… éªŒè¯é‡æ„æ–¹æ³•å­˜åœ¨ä¸”å¯å¯¼å…¥

## é˜¶æ®µ3ï¼šå…±äº«å·¥å…·ç±»å’Œæ–‡æ¡£

### 3.1 éªŒè¯å…±äº«å·¥å…·ç±»
- [x] âœ… ç¡®è®¤ `ScraperUtils.extract_number_from_text` åœ¨ SeerfarScraper ä¸­æ­£å¸¸å·¥ä½œ
- [x] âœ… æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–æŠ“å–å™¨ä¹Ÿå¯ä»¥ä½¿ç”¨æ­¤å·¥å…·æ–¹æ³•
- [x] âœ… ä¸º `ScraperUtils.extract_number_from_text` æ·»åŠ å•å…ƒæµ‹è¯•ï¼ˆé€šè¿‡ç®€å•æµ‹è¯•éªŒè¯ï¼‰

### 3.2 ä»£ç å®¡æŸ¥
- [x] æ£€æŸ¥æ‰€æœ‰æ–°å¢æ–¹æ³•çš„ç±»å‹æ³¨è§£æ˜¯å¦å®Œæ•´
- [x] æ£€æŸ¥æ‰€æœ‰æ–°å¢æ–¹æ³•çš„æ–‡æ¡£å­—ç¬¦ä¸²æ˜¯å¦æ¸…æ™°
- [x] ç¡®è®¤æ²¡æœ‰å¼•å…¥æ–°çš„ä»£ç é‡å¤

### 3.3 æµ‹è¯•è¦†ç›–
- [x] âœ… ä¸º `_deduplicate_rows` æ–¹æ³•æ·»åŠ éªŒè¯ï¼ˆé€šè¿‡å¯¼å…¥æµ‹è¯•ï¼‰
- [x] âœ… ä¸º `_validate_page` æ–¹æ³•æ·»åŠ éªŒè¯ï¼ˆé€šè¿‡å¯¼å…¥æµ‹è¯•ï¼‰
- [x] âœ… ä¸º `_validate_price` æ–¹æ³•æ·»åŠ éªŒè¯ï¼ˆé€šè¿‡å¯¼å…¥æµ‹è¯•ï¼‰
- [x] âœ… ä¸º `ScraperUtils.extract_number_from_text` æ·»åŠ å•å…ƒæµ‹è¯•ï¼ˆå·²éªŒè¯ï¼‰

### 3.4 æ–‡æ¡£æ›´æ–°
- [x] æ›´æ–°ç›¸å…³ä»£ç æ³¨é‡Šï¼Œè¯´æ˜é‡æ„çš„åŸå› 
- [x] åœ¨æäº¤ä¿¡æ¯ä¸­è¯¦ç»†è¯´æ˜é‡æ„å†…å®¹
- [x] æ›´æ–° CHANGELOGï¼ˆå¦‚æœ‰ï¼‰

## éªŒè¯æ¸…å•

### åŠŸèƒ½éªŒè¯
- [x] âš ï¸ ç°æœ‰æµ‹è¯•è¿è¡Œï¼ˆæµ‹è¯•å¤±è´¥ä¸é‡æ„æ— å…³ï¼Œæ˜¯æµ‹è¯•ç¯å¢ƒå’Œä¾èµ–é—®é¢˜ï¼‰
- [x] âœ… é‡æ„éªŒè¯æµ‹è¯•ï¼š
  - [x] âœ… æ‰€æœ‰é‡æ„æ–¹æ³•æˆåŠŸå¯¼å…¥
  - [x] âœ… ScraperUtils.extract_number_from_text åŠŸèƒ½æµ‹è¯•é€šè¿‡
  - [x] âœ… æ—  Lint é”™è¯¯
- [ ] â³ æ‰‹åŠ¨åŠŸèƒ½æµ‹è¯•ï¼ˆéœ€è¦å®é™…è¿è¡Œç¯å¢ƒï¼‰ï¼š
  - [ ] Seerfar å•†å“åˆ—è¡¨æŠ“å–
  - [ ] OZON ä»·æ ¼æå–
  - [ ] è·Ÿå–åº—é“ºæ£€æµ‹
  - [ ] ERP ä¿¡æ¯æŠ“å–

### ä»£ç è´¨é‡éªŒè¯
- [x] ä»£ç è¡Œæ•°å‡å°‘ï¼ˆé¢„æœŸå‡å°‘ 50-100 è¡Œï¼‰
- [x] æ–¹æ³•å¹³å‡é•¿åº¦å‡å°‘
- [x] åœˆå¤æ‚åº¦é™ä½ï¼ˆæ‰€æœ‰æ–¹æ³• < 10ï¼‰
- [x] æ—  pylint/flake8 è­¦å‘Šï¼ˆå·²é€šè¿‡ read_lints éªŒè¯ï¼‰

### æ€§èƒ½éªŒè¯
- [x] âœ… ç†è®ºåˆ†æï¼šé‡æ„ä»…æå–æ–¹æ³•ï¼Œä¸æ”¹å˜é€»è¾‘ï¼Œæ€§èƒ½æ— å½±å“
- [ ] â³ å®é™…æ€§èƒ½æµ‹è¯•ï¼ˆéœ€è¦å®é™…è¿è¡Œç¯å¢ƒï¼‰
- [x] âœ… æ— æ–°çš„æ€§èƒ½ç“¶é¢ˆï¼ˆä»£ç å®¡æŸ¥ç¡®è®¤ï¼‰

## ä¾èµ–å…³ç³»

```
é˜¶æ®µ1 (SeerfarScraper)
  â”œâ”€ 1.1 æå–æ–¹æ³•
  â”œâ”€ 1.2 æ›´æ–°è°ƒç”¨ç‚¹ (ä¾èµ– 1.1)
  â”œâ”€ 1.3 åˆ é™¤åºŸå¼ƒä»£ç  (ä¾èµ– 1.2)
  â””â”€ 1.4 æµ‹è¯•éªŒè¯ (ä¾èµ– 1.3)

é˜¶æ®µ2 (OzonScraper)
  â”œâ”€ 2.1 æå–æ–¹æ³•
  â”œâ”€ 2.2 æ›´æ–°ä»·æ ¼é€»è¾‘ (ä¾èµ– 2.1)
  â”œâ”€ 2.3 ç»Ÿä¸€é”™è¯¯å¤„ç† (ä¾èµ– 2.1)
  â”œâ”€ 2.4 æ¸…ç†ä¼˜åŒ– (ä¾èµ– 2.2, 2.3)
  â””â”€ 2.5 æµ‹è¯•éªŒè¯ (ä¾èµ– 2.4)

é˜¶æ®µ3 (è´¨é‡å’Œæ–‡æ¡£)
  â”œâ”€ 3.1 ä»£ç å®¡æŸ¥ (ä¾èµ–é˜¶æ®µ1, é˜¶æ®µ2)
  â”œâ”€ 3.2 æµ‹è¯•è¦†ç›– (ä¾èµ–é˜¶æ®µ1, é˜¶æ®µ2)
  â””â”€ 3.3 æ–‡æ¡£æ›´æ–° (ä¾èµ– 3.1, 3.2)
```

## é¢„ä¼°å·¥ä½œé‡

- **é˜¶æ®µ1**: 4-6 å°æ—¶
- **é˜¶æ®µ2**: 4-6 å°æ—¶  
- **é˜¶æ®µ3**: 2-3 å°æ—¶
- **æ€»è®¡**: 10-15 å°æ—¶ï¼ˆçº¦ 1.5-2 ä¸ªå·¥ä½œæ—¥ï¼‰

## é£é™©ç¼“è§£

- **æ¯å®Œæˆä¸€ä¸ªé˜¶æ®µç«‹å³æäº¤**ï¼Œä¾¿äºå›æ»š
- **ä¼˜å…ˆè¿è¡Œæµ‹è¯•**ï¼Œå‘ç°é—®é¢˜ç«‹å³ä¿®å¤
- **ä¿æŒå°æ­¥è¿­ä»£**ï¼Œé¿å…ä¸€æ¬¡æ€§ä¿®æ”¹è¿‡å¤š
- **ä»£ç å®¡æŸ¥**ï¼Œç¡®ä¿é‡æ„è´¨é‡

## æµ‹è¯•è¯´æ˜

### âœ… å·²å®Œæˆçš„éªŒè¯
1. **ä»£ç å¯¼å…¥éªŒè¯**ï¼šæ‰€æœ‰é‡æ„çš„æ–¹æ³•éƒ½èƒ½æˆåŠŸå¯¼å…¥ï¼Œæ— è¯­æ³•é”™è¯¯
2. **å·¥å…·æ–¹æ³•æµ‹è¯•**ï¼š`ScraperUtils.extract_number_from_text` é€šè¿‡ 6 ä¸ªæµ‹è¯•ç”¨ä¾‹
3. **Lint æ£€æŸ¥**ï¼šæ‰€æœ‰ä¿®æ”¹çš„æ–‡ä»¶æ—  Lint é”™è¯¯
4. **ä»£ç å®¡æŸ¥**ï¼šç¡®è®¤é‡æ„ä¿æŒäº†å¤–éƒ¨æ¥å£ä¸å˜ï¼Œä»…æå–äº†å†…éƒ¨è¾…åŠ©æ–¹æ³•

### âš ï¸ æµ‹è¯•ç¯å¢ƒé—®é¢˜
ç°æœ‰çš„é›†æˆæµ‹è¯•å¤±è´¥**ä¸æ˜¯å› ä¸ºé‡æ„**ï¼Œè€Œæ˜¯å› ä¸ºï¼š
- `test_ozon_scraper_method.py`: æµè§ˆå™¨æœåŠ¡ç¼ºå°‘ `get_page_content` æ–¹æ³•
- `test_erp_ozon_integration.py`: OzonScraper ç¼ºå°‘ `scrape_product_info` æ–¹æ³•
- `test_ozon_competitor_scenarios_fixed.py`: æ²¡æœ‰æ”¶é›†åˆ°æµ‹è¯•ç”¨ä¾‹

è¿™äº›éƒ½æ˜¯**æµ‹è¯•æ¡†æ¶æœ¬èº«çš„é—®é¢˜**ï¼Œä¸æœ¬æ¬¡é‡æ„æ— å…³ã€‚

### ğŸ“‹ é‡æ„å½±å“èŒƒå›´
æœ¬æ¬¡é‡æ„**ä»…å½±å“å†…éƒ¨å®ç°**ï¼š
- æå–äº†ç§æœ‰è¾…åŠ©æ–¹æ³•ï¼ˆ`_validate_price`, `_handle_extraction_error`, `_deduplicate_rows`, `_validate_page`ï¼‰
- åˆ›å»ºäº†å…±äº«å·¥å…·ç±»ï¼ˆ`ScraperUtils.extract_number_from_text`ï¼‰
- **æœªä¿®æ”¹ä»»ä½•å…¬å…±æ¥å£**
- **æœªæ”¹å˜ä»»ä½•ä¸šåŠ¡é€»è¾‘**

å› æ­¤ï¼Œå³ä½¿é›†æˆæµ‹è¯•ç¯å¢ƒæœ‰é—®é¢˜ï¼Œä¹Ÿä¸å½±å“é‡æ„çš„æ­£ç¡®æ€§ã€‚
