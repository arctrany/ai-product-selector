# Change: 添加跨平台 xp 命令支持

## Why

### 业务痛点
当前系统虽然提供了 `xp` 脚本作为 CLI 入口，但在不同操作系统上的使用体验不一致：
- **Linux/macOS**: 需要手动添加执行权限（`chmod +x xp`），且需要用户手动安装依赖
- **Windows**: 需要用户手动运行 `xp.bat` 或 `xp.ps1`，依赖安装需要额外步骤
- **用户体验**: 新用户需要了解 Python 环境和依赖管理，增加了使用门槛

### 业务价值
- **降低使用门槛**: 用户只需运行 `xp` 命令即可使用，无需了解 Python 环境配置
- **自动化依赖管理**: 首次运行时自动检测并安装缺失依赖，减少配置错误
- **跨平台一致性**: 在 Windows、Linux、macOS 上提供统一的命令接口
- **提升开发效率**: 开发者可以在任何平台上使用相同的命令进行开发和测试

### 典型场景
1. **新用户首次使用**:
   - 克隆项目后，直接运行 `xp --help` 即可查看帮助
   - 系统自动检测并安装缺失的依赖包
   - 无需手动执行 `pip install -r requirements.txt`

2. **跨平台开发**:
   - 开发者在 Windows 上开发，在 Linux 服务器上部署
   - 使用相同的 `xp` 命令，无需关心平台差异

3. **CI/CD 集成**:
   - 自动化脚本可以直接调用 `xp` 命令
   - 无需额外的环境准备步骤

## What Changes

### 功能变更
- ✅ **跨平台可执行脚本**: 
  - Linux/macOS: 改进 `xp` 脚本，自动检测并安装依赖
  - Windows: 改进 `xp.bat`，自动检测并安装依赖
  - 统一命令接口：所有平台都使用 `xp` 命令（Windows 使用 `xp.bat`）

- ✅ **自动依赖检测和安装**:
  - 首次运行时检测 Python 依赖（requirements.txt）
  - 自动安装缺失的依赖包
  - 安装 Playwright 浏览器驱动（如果缺失）
  - 提供清晰的进度提示和错误处理

- ✅ **智能环境检测**:
  - 检测 Python 版本（需要 Python 3.8+）
  - 检测 pip 是否可用
  - 检测虚拟环境状态
  - 提供友好的错误提示

### 技术实现
- **依赖检测模块**: 创建 `cli/dependency_checker.py` 用于检测和安装依赖
- **跨平台脚本增强**: 
  - `xp` (Linux/macOS): 添加依赖检查和安装逻辑
  - `xp.bat` (Windows): 添加依赖检查和安装逻辑
- **错误处理**: 提供清晰的错误消息和解决建议

### 数据结构变更
**无破坏性变更** - 所有变更都是向后兼容的，现有用户无需修改使用方式。

## Impact

### 影响的 Specs
- **cli**: 核心变更，新增跨平台命令支持和自动依赖管理功能

### 影响的代码文件
- `xp` - Linux/macOS 可执行脚本，添加依赖检测和安装
- `xp.bat` - Windows 批处理脚本，添加依赖检测和安装
- `cli/dependency_checker.py` - 新建：依赖检测和安装模块
- `cli/main.py` - 可能需要集成依赖检查（可选）

### 性能影响
- **首次运行**: 如果依赖缺失，首次运行会增加 30-60 秒的安装时间
- **后续运行**: 无性能影响，依赖检测是轻量级操作（< 1秒）
- **影响评估**: 可接受，因为只需要在首次运行时执行一次

### 风险评估
1. **网络依赖**: 依赖安装需要网络连接 - **风险等级: 低**，已有错误提示
2. **权限问题**: 某些系统可能需要管理员权限安装包 - **风险等级: 中**，提供用户友好的提示
3. **依赖冲突**: 用户环境中已有冲突的包版本 - **风险等级: 低**，使用 `--user` 或虚拟环境
4. **跨平台兼容性**: 不同平台的脚本行为可能不一致 - **风险等级: 低**，通过统一接口和测试保证

## Migration Plan

### 向后兼容性
✅ **完全向后兼容** - 现有用户仍可使用 `python xp` 或 `python cli/main.py` 的方式运行，新功能是可选的增强。

### 可选迁移
如果用户希望使用新的自动依赖管理功能：
1. 无需任何操作，首次运行 `xp` 或 `xp.bat` 时会自动启用
2. 如果用户希望禁用自动安装，可以设置环境变量 `XP_SKIP_DEP_CHECK=1`

## Success Metrics

- ✅ 在 Windows、Linux、macOS 上都能成功运行 `xp` 命令
- ✅ 首次运行时自动检测并安装缺失依赖
- ✅ 依赖安装失败时提供清晰的错误提示和解决建议
- ✅ 所有现有测试用例通过，无回归问题
- ✅ 用户体验测试：新用户能在 5 分钟内成功运行命令

