# Spec Delta: seerfar-scraper

## 变更类型
MODIFICATION - 修改现有规范以支持完全同步的数据抓取架构

## 变更内容

### 新增 Requirement: 同步数据抓取架构
系统 SHALL 使用完全同步的数据抓取架构，不再依赖异步操作。

#### Scenario: 同步销售数据提取
- **WHEN** 调用销售数据提取方法
- **THEN** 系统应使用同步方法从 `.store-total-revenue` 选择器提取数据
- **AND** 直接调用 browser_service 的同步方法
- **AND** 确保元素查找的可靠性和时序正确性

#### Scenario: 同步产品列表抓取
- **WHEN** 抓取产品列表数据
- **THEN** 系统应使用同步方法遍历产品行
- **AND** 同步提取每个产品的详细信息
- **AND** 应用产品过滤逻辑

#### Scenario: 同步超时处理
- **WHEN** 数据抓取操作执行时
- **THEN** 系统应为每个操作设置合适的同步超时
- **AND** 销售数据提取超时：30秒
- **AND** 产品列表抓取超时：60秒
- **AND** 单个产品详情抓取超时：15秒

### 修改 Requirement: 错误处理机制
增强错误处理以支持同步操作的重试和恢复。

#### Scenario: 同步重试机制
- **WHEN** 数据抓取失败
- **THEN** 系统应实现同步重试逻辑
- **AND** 网络相关错误最多重试3次
- **AND** 元素查找失败等待1-2秒后重试
- **AND** 使用指数退避避免频繁重试

## 技术实现说明

**移除的功能**：
- 所有 `async def` 方法定义
- `await` 关键字的使用
- 异步事件循环依赖

**新增的功能**：
- 同步方法实现（如 `_extract_sales_data`）
- 同步超时控制机制
- 同步重试和错误处理逻辑

**保持不变**：
- 数据提取的业务逻辑
- 选择器配置和使用
- 产品过滤和验证规则

## 兼容性影响

**Breaking Changes**：
- 所有异步方法签名变更为同步
- 调用方式从 `await method()` 改为 `method()`

**向后兼容**：
- 抓取的数据格式保持不变
- 对外接口的返回值保持一致
- 配置文件格式不变
